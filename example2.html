<!DOCTYPE html>
<html lang='en'>
    <head>
    <link rel='stylesheet' id='all-css-0' href='http://s2.wp.com/_static/??/wp-includes/css/admin-bar.css,/wp-content/mu-plugins/notes/admin-bar-rest.css,/wp-content/mu-plugins/subscriptions/follow.css,/wp-content/mu-plugins/hover-bubbles/style.css,/wp-content/mu-plugins/infinity/themes/pub/splendio.css,/wp-content/mu-plugins/admin-bar/wpcom-admin-bar.css,/i/noticons/noticons.css,/wp-content/mu-plugins/post-flair/style.css?m=1345713921j' type='text/css' media='all' />
    <link rel='stylesheet' id='droid-sans-css'  href='http://fonts.googleapis.com/css?family=Droid+Sans%3Aregular%2Cbold&#038;ver=20120821' type='text/css' media='all' />
	<link rel='stylesheet' id='print-css-2' href='http://s0.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1335386953g' type='text/css' media='print' />
	<link rel='stylesheet' id='all-css-2' href='http://s1.wp.com/_static/??/wp-content/mu-plugins/post-flair/sharing/sharing.css,/wp-content/themes/h4/global.css?m=1345177132j' type='text/css' media='all' />
	<link rel="stylesheet" type="text/css" media="all" href="http://s0.wp.com/wp-content/themes/pub/splendio/style.css?m=1340737315g" />
    <style type="text/css">/* Site Title */ .wf-loading #branding group .site-title { visibility: hidden; } .wf-active #branding group .site-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-style: normal; font-weight: 700; font-variant: normal; } 
/* Headings */ .wf-loading #header-auxiliary .header-search .search-title { visibility: hidden; } .wf-active #header-auxiliary .header-search .search-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 1.23re; } .wf-loading .latest-title { visibility: hidden; } .wf-active .latest-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 1.23re; } .wf-loading .other-news-title { visibility: hidden; } .wf-active .other-news-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 1.23re; } .wf-loading #other-news li { visibility: hidden; } .wf-active #other-news li { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 1.32re; } .wf-loading .entry-title { visibility: hidden; } .wf-active .entry-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 2.29re; } .wf-loading .page-title,.wf-loading body.page .entry-title,.wf-loading body.single .entry-title { visibility: hidden; } .wf-active .page-title,.wf-active body.page .entry-title,.wf-active body.single .entry-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 3.17re; } .wf-loading .featured-posts .entry-title { visibility: hidden; } .wf-active .featured-posts .entry-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-style: normal; font-weight: 700; font-variant: normal; font-size: 2.46re; } .wf-loading #entry-author-info h2 { visibility: hidden; } .wf-active #entry-author-info h2 { font-size: 88%; font-weight: 700; } .wf-loading #comments-title { visibility: hidden; } .wf-active #comments-title { font-size: 2.11re; font-weight: 700; } .wf-loading #reply-title { visibility: hidden; } .wf-active #reply-title { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Helvetica,!important; font-style: normal; font-weight: 700; font-variant: normal; font-size: 2.11re; } .wf-loading #secondary .widget-title { visibility: hidden; } .wf-active #secondary .widget-title { font-size: 1.23re; font-weight: 700; } .wf-loading #secondary .widget_twitter .widget-title { visibility: hidden; } .wf-active #secondary .widget_twitter .widget-title { font-size: 1.23re; } .wf-loading #footer-widget-area .widget-area .widget-title { visibility: hidden; } .wf-active #footer-widget-area .widget-area .widget-title { font-size: 1.76re; font-weight: 700; } 
/* Body Text */ .wf-loading body,.wf-loading button,.wf-loading input,.wf-loading select,.wf-loading textarea { visibility: hidden; } .wf-active body,.wf-active button,.wf-active input,.wf-active select,.wf-active textarea { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-variant: normal; } .wf-loading #branding hgroup .site-description { visibility: hidden; } .wf-active #branding hgroup .site-description { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-variant: normal; } .wf-loading #header-auxiliary .header-search input { visibility: hidden; } .wf-active #header-auxiliary .header-search input { font-family: ronnia-1,ronnia-2,"Trebuchet MS",Arial,Helvetica,sans-serif; font-variant: normal; } .wf-loading #header-auxiliary .header-search button { visibility: hidden; } .wf-active #header-auxiliary .header-search button { font-family: ronnia-1,ronnia-2,"Trebuchet MS",Arial,Helvetica,sans-serif; font-variant: normal; } .wf-loading .site-navigation .menu-header,.wf-loading div.menu { visibility: hidden; } .wf-active .site-navigation .menu-header,.wf-active div.menu { font-family: ronnia-1,ronnia-2,"Trebuchet MS",Arial,Helvetica,sans-serif; font-variant: normal; } .wf-loading .site-navigation ul ul li { visibility: hidden; } .wf-active .site-navigation ul ul li { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",Verdana,sans-serif; font-variant: normal; } .wf-loading .featured-posts { visibility: hidden; } .wf-active .featured-posts { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-variant: normal; } .wf-loading .comment-author cite { visibility: hidden; } .wf-active .comment-author cite { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-variant: normal; } .wf-loading #respond textarea { visibility: hidden; } .wf-active #respond textarea { font-family: ronnia-1,ronnia-2,Georgia,"Times New Roman",Times,serif; font-variant: normal; } .wf-loading #respond .form-submit input { visibility: hidden; } .wf-active #respond .form-submit input { font-family: ronnia-1,ronnia-2,"Droid Sans","Trebuchet MS",sans-serif; font-variant: normal; } .wf-loading .widget_search input[type=text] { visibility: hidden; } .wf-active .widget_search input[type=text] { font-family: ronnia-1,ronnia-2,"Trebuchet MS",Arial,Helvetica,sans-serif; font-variant: normal; } .wf-loading .widget_search input[type=submit] { visibility: hidden; } .wf-active .widget_search input[type=submit] { font-family: ronnia-1,ronnia-2,"Trebuchet MS",Arial,Helvetica,sans-serif; font-variant: normal; } 
</style>
	<style type="text/css">
		#wrapper {
			background: #fff;
		}
			body {
			background: none;
		}
		#colophon .site-info {
			padding: 1em;
		}
		</style>
	<style type="text/css" media="print">#wpadminbar { display:none; }</style>
<style type="text/css" media="screen">
	html { margin-top: 28px !important; }
	* html body { margin-top: 28px !important; }
</style>

    
    
    <style type="text/css">
         
    html, body {
 	 height: 100%;
 	 margin: 50;
  	 padding: 0;
	}

	results {
		padding: 50px;
		float: none;
		position: relative;
	
	}
	
	#map_canvas {
		position: relative;
		float:left;
	}
	addrInput{
		float: left;
		position: relative;
	}
	
	form {
		display: inline-block;
		position: relative;
		width: 40%;
		float: none;
	}
	
	.googft-info-window td { background-color: white }
	

    </style>
        <meta charset='utf-8'/>    
        <title>Boston Public Schools</title>
     </head>
  <body onload="initialize()">
    <div style="float:left;">
    <div id="instructions">Enter your home address and school type to explore your school options for the different scenarios.<br /><br /></div>
    
     <form id="scenario" style="width=60px;">
    <fieldset>
    <legend><strong>General Education</strong></legend>
		<input type="radio" name="zoneKey" id="sixZ" /> 6 Zones<br />
		<input type="radio" name="zoneKey" id="nineZ" /> 9 Zones<br />
		<input type="radio" name="zoneKey" id="elevenZ" /> 11 Zones<br />
	</fieldset>
	</form>
	<form id="schoolType" style="width=60px;">
	<fieldset>
	<legend><strong>Special Programs</strong></legend>
		<input type="radio" name="schoolKey" id="sped" /> Students with Disabilities<br />
		<input type="radio" name="schoolKey" id="ell" /> English Language Learners<br />
		<br />
	</fieldset>
	</form>
	<br />
	<br />
	<div id="addrInput"> 
	Home address: <input id="address" size="60" type="textbox" value="Boston, MA"><input type="button" value="Go!" onclick="codeAddress()"><br /></div>
    </div>
    
    <div id="map_canvas" style="height:100%;width:100%;top:10px"></div>
    <div id="results"></div>
</body>
 <script type="text/javascript">
	  var geocoder;
      var map;
      var marker;
      var circle;
      var zoneLayer;
      var zoneKey;
      var specialZone;
      var bostonLayer;
      var schoolLayerResults;
      var schoolKey;
      var scenario;
      var zoneNum;
      
      
	  var basemap = [
		  {
		    "featureType": "landscape",
		    "elementType": "geometry",
		    "stylers": [
		      { "visibility": "on" },
		      {"saturation": -100},
                {"gamma": 0.50}
		    ]
		  },{
		    "featureType": "water",
		    "stylers": [
		      { "visibility": "simplified" },
		      { "color": "#97d6f4" },
		      { "saturation": -32 }
		    ]
		  },{
		    "featureType": "road",
		    "elementType": "geometry",
		    "stylers": [
		      { "weight": 0.4 },
		      { "color": "#ffffff" },
		      { "visibility": "on" }
		    ]
		  },{
		    "featureType": "road",
		    "elementType": "labels",
		    "stylers": [
		      { "visibility": "simplified" }
		    ]
		  }
		];
      
      
      function appendResults(text) {
        var results = document.getElementById('results');
        //results.appendChild(document.createElement('P'));
        //results.appendChild(document.createTextNode("Zone = " + text.rows));
      }


      function makeRequest() {
        var request = gapi.client.fusiontables.query.sql({
          'sql': 'select rowid from 1TxUFGt0HZYIIhrs9wm98FJwcf6DPQTb7Djp0aMU'
        });
        request.execute(function(response) {
          //appendResults(response);
        });
      }


      function load() {
	    //google.load('visualization', '1');
        gapi.client.setApiKey('AIzaSyBCGVOPKeRp1pSS641UQc0Fl__SAMQimHI');
        gapi.client.load('fusiontables', 'v1', makeRequest);    
      }


	  function initialize() {
        geocoder = new google.maps.Geocoder();
        var infoWindow = new google.maps.InfoWindow();
        
        var latlng = new google.maps.LatLng(42.3200, -71.084); //boston
        var BostonStyle = new google.maps.StyledMapType(basemap, {name: "Boston Public Schools"});
        
        var mapOptions = {
          center: latlng,
          zoom: 12,
          mapTypeControlOptions: { mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'Boston Public Schools']}
        };
        map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
        map.mapTypes.set('Boston Public Schools', BostonStyle);
        map.setMapTypeId('Boston Public Schools');
        
        //boston outline
        bostonLayer = new google.maps.KmlLayer('city_boundary.kml', { preserveViewport: true});
		bostonLayer.setMap(map);
		console.log("boston boundaries");
		
		var schoolIcon = 'schoolicon-01.png';
			
      }

      
      function codeAddress() {
      
        var address = document.getElementById('address').value;
        
        /*
        
        SCENARIO - 6
        schools: 1HIL5eYvKwic6bvOHM8StEhdH_PVmk2K2Op59lgc
        zone: 1JouUBlL3ZlGC8TAsRXEPeqQyrmIMx3acgdO-Jo0
        
        SCENARIO - 9
        schools: 1JeHVt0yTFcgjmTS5JPcfsybgfRxVSkn2xZhxRM0
        zone:1gqE8zik8SGPUGo5TeVPrlPgD23ZrWwL6Q5bJfnU
        
        SCENARIO - 11
        schools: 1g2WTYFk3vbYJ1d8_mMrcfWQRylLczT-wafYbnAY
        zone: 1i6CgHn4CNukzT_AcNJUoBcS7PgxWFE4kCQTPbU8
        
        ell
        zone: 1vHRlXwYLozifwaBgcXbnLd5d3Be4XT65NfWthX0
        
        sped
        zone: 1BLm4bd-ejBBT8PtOu9lanCjCIZcCCY_c14059mg
        
        middle school
        zone: 1a4luco0-QDFWfQKxgciZbnXJrG9Z2x9awgJn3Z8
        
        */
        if (document.getElementById('sixZ').checked) {
		    zoneNum = "six";
		    scenario = "gened";
		   	schoolKey = "1HIL5eYvKwic6bvOHM8StEhdH_PVmk2K2Op59lgc";
     	    zoneKey = "1JouUBlL3ZlGC8TAsRXEPeqQyrmIMx3acgdO-Jo0";
		   	
		} else if (document.getElementById('nineZ').checked) {
		   zoneNum = "nine";
		   scenario = "gened";
		   schoolKey = "1JeHVt0yTFcgjmTS5JPcfsybgfRxVSkn2xZhxRM0";
           zoneKey = "1gqE8zik8SGPUGo5TeVPrlPgD23ZrWwL6Q5bJfnU";
		   
		} else if (document.getElementById('elevenZ').checked) {
		   zoneNum = "eleven";
		   scenario = "gened";
		   schoolKey = "1g2WTYFk3vbYJ1d8_mMrcfWQRylLczT-wafYbnAY";
           zoneKey = "1i6CgHn4CNukzT_AcNJUoBcS7PgxWFE4kCQTPbU8";
		   	   
		} else if(document.getElementById('ell').checked) {
		   zoneNum = "NA";
		   scenario = "ell";
		   schoolKey = "";
		   zoneKey = "1vHRlXwYLozifwaBgcXbnLd5d3Be4XT65NfWthX0";
		  
		} else if(document.getElementById('sped').checked) {
		   zoneNum = "NA";
		   scenario = "sped";
		   schoolKey = "";
		   zoneKey = "1BLm4bd-ejBBT8PtOu9lanCjCIZcCCY_c14059mg";
		  
		}  
   
        console.log("scenario = " + scenario + ", zones = " + zoneNum);
        
        console.log(address);
        if (address === null) {
        	return;
        }
        
        geocoder.geocode( {'address': address}, function(results, status) {
                    
          if (status == google.maps.GeocoderStatus.OK) {
           	var addrLatLng = results[0].geometry.location;
           	queryForZone(addrLatLng);
           	console.log(addrLatLng);
           	
      		if (marker) {
			    marker.setMap(null);
			    marker = null;
			}  
			 
     
            if (marker == null || marker === undefined) {
	            map.setCenter(addrLatLng);
	            map.setZoom(13);
	            marker = new google.maps.Marker({
	                map: map,
	                position: addrLatLng
	            });
	    	}
            
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }
      
      // unset the zone, query & school layers
      function clearMapLayers() {
      		if (bostonLayer) {
		    	bostonLayer.setMap(null);
		    	bostonLayer = null;
		    	console.log("Initial Boston Layer cleared")
		    }
		    
		    if (schoolLayerResults){
			    schoolLayerResults.setMap(null);
		    	schoolLayerResults = null;
				console.log("School Layer Results cleared");
		    }
		    
		    if(zoneLayer){
		    	zoneLayer.setMap(null);
		    	zoneLayer = null;
		    	console.log("Zone Layer cleared");	
		    }
      }
      
      var createMarker = function(coordinate, store, delivery) {
          var marker = new google.maps.Marker({
            map: map,
            position: coordinate,
            icon: new google.maps.MarkerImage('schoolicon-01.png')
          });
          google.maps.event.addListener(marker, 'click', function(event) {
            infoWindow.setPosition(coordinate);
            infoWindow.setContent(store + '<br>Delivers? ' + delivery);
            infoWindow.open(map);
          });
        };
      
      
      function queryForZone(addrLatLng) {

		    clearMapLayers();
		    
		    var zoneQueryResult;		    
		    var zoneQuery = 'select Zone from ' + zoneKey 
		    	+ ' where ST_INTERSECTS(geometry, CIRCLE( LATLNG(' 
		    	+ addrLatLng.Xa + ', ' + addrLatLng.Ya + '), 1))';
		    console.log(zoneQuery);
		     
		     
		    var request = gapi.client.fusiontables.query.sql({
          		'sql': zoneQuery
        	});
        	
        	request.execute(function(response) {
        		console.log("RESPONSE = " + response.rows);
        		appendResults(response);
          		zoneQueryResult = response.rows;
          		console.log("zoneQueryResult = " + zoneQueryResult);
          		queryForSchool(addrLatLng, zoneQueryResult);
        	}); 
        	
     } // end queryForZone
     
     
     function setZoneLayerOnMap(table, id) {
     	zoneLayer = new google.maps.FusionTablesLayer({
			query: {
				select: 'geometry',
				from: table,
				where: 'Zone = ' + id
			}
		});
		
		zoneLayer.setMap(map);
		
     } // end setZoneLayerOnMap
     
     
     function queryForSchool(addrLatLng, zoneQueryResult){
		    
		    clearMapLayers();
		    
		    var whereClauseZone = 'Zone = ' + zoneQueryResult;
		    var whereClauseIntersect = 'ST_INTERSECTS(geometry, CIRCLE( LATLNG(' 
		    	+ addrLatLng.Xa + ', ' + addrLatLng.Ya + '), 1200))';  
		    
		    setZoneLayerOnMap(zoneKey, zoneQueryResult);
		    	
		    if (scenario === 'ell') {		    	
						
				schoolLayerResults = new google.maps.FusionTablesLayer({
					query: {
						select: 'geometry',
						from: schoolKey
					},
					styles: [
					{
						where: whereClauseZone,
							markerOptions: {
						      iconName: "placemark_square" 
						    }
					   }
					]
				});							
				
		    } else if (scenario === 'sped') {
		    					
				schoolLayerResults = new google.maps.FusionTablesLayer({
					query: {
						select: 'geometry',
						from: schoolKey
					},
					styles: [
						{
						where: whereClauseZone,
							markerOptions: {
						      iconName: "placemark_square" 
						    }
					   }
					]
				});
		    
		    } else {  // General Education
		    	
				schoolLayerResults = new google.maps.FusionTablesLayer({
					query: {
						select: 'geometry',
						from: schoolKey
					},
					styles: [
					  {
						 where: whereClauseZone,
							markerOptions: {
						      iconName: "placemark_square" 
						    }
					   },
					   {
					   	 where: whereClauseIntersect,
						   	markerOptions: {
						      iconName: "placemark_square_highlight"
						    }
					   }
					]
				});
		    }
		    schoolLayerResults.setMap(map);
      }
    </script>
    <script src="https://apis.google.com/js/client.js?onload=load"></script>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

</html>
